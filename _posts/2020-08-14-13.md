---
layout: post
title: LLVM IR (2)
date: 2020-08-14
Author: yarncha
categories:
tags: [난독화, LLVM]
comments: true
---

패스 만드는법도 같이 정리해둬야쥐(❁´◡`❁)

# -LLVM Pass 만들기

https://yam-cha.tistory.com/69?category=935948

이 글에서처럼 lib/Transform/Name에 CMakeList.txt 파일과 Name.cpp을 만들고, 그 상위폴더인 lib/Transform에 있는 CMakeList.txt의 맨 아랫줄에 add_subdirectory(Name)을 추가해줌

cpp에서 동작을 작성할 수 있고 상위 폴더에서 make를 해서 만들어진 .so파일을 확인할 수 있음

# -input 파일 만들기

C 파일을 생성하고
clang name.c -o name 명령어를 통해 컴파일

clang -O3 -emit-llvm name.c -c -o name.bc 명령어를 통해 c파일을 llvm 비트코드 파일로 변환

./name 또는 lli name.bc를 통해 실행할 수 있음

gcc hello.s -o hello.native

# -그 이후

pass와 input파일이 준비되면
opt -load lib/NAME.so -INPUT < INPUT.bc > /dev/null 을 통해 출력 볼수있고

opt -load lib/NAME.so -help 이건 패스에 대한 도움말이랑
opt -load lib/NAME.so -INPUT -time-passes < INPUT.bc > /dev/null 이건 시간측정같은거?

# -직접 해보기

### 01

https://www.cs.cornell.edu/~asampson/blog/clangpass.html

자꾸 내가 만든 파일에서 실행이 안 되어서 이 페이지를 참고해봐도

![](<\images\13_01.png>)

여기에 뭐가 들어가야하는지 잘 모르겠다... 아무래도 skeleton 코드는 clang -Xclang -load -Xclang ~.so 이런 명령어로 실행되게 바꿔놓은듯함

예전 코드를 참고해보니까

![](<\images\13_02.png>)
![](<\images\13_03.png>)

노란색 부분에서 다른 점이 있어서 다시 패스를 수정해보기로!

해결되면 ModulePass를 다루는 부분을 해 볼 것이다.

### 02
